import { Injectable } from '@angular/core';
import { environment } from '../../environments/environment';
import { BehaviorSubject, Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})

export class BaseService {

	public baseUrl:string = environment.baseUrl;
	public currentUser:any;

	constructor() { this.setCurrentUser(); }

	public getCurrentUser() {
		return JSON.parse(localStorage.getItem('currentUser'));
	}

	public setCurrentUser() {
    	let data = { 'token':"gdgsdvxd", 'role':'external', 'name':'test' };
		localStorage.setItem('currentUser', JSON.stringify(data));
	}

	public isLoggedIn(): boolean {
		if(this.getCurrentUser() != undefined) {
		  return true;
		}
		return false;
	}

	public login() {

	}

	public logout() {
		console.log("logout");
		localStorage.clear();
	}

	public isAuthorized(allowedRoles: string[]) : boolean {
		if (allowedRoles == null || allowedRoles.length === 0) {
	      return true;
	    }

	    let user = this.getCurrentUser();
	    if(user.token == "") {
	    	return false;
	    }

	    if(allowedRoles.includes(user.role)) {
	    	return true;
	    }
		return false;
	}
}
